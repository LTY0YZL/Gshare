packages:
  yum:
    supervisor: []   

files:
  "/etc/supervisord.d/qcluster.ini":
    mode: "000644"
    owner: root
    group: root
    content: |
      [program:qcluster]
      command=/var/app/venv/*/bin/python /var/app/current/manage.py qcluster
      directory=/var/app/current
      autostart=true
      autorestart=true
      stopsignal=INT
      stdout_logfile=/var/log/qcluster-stdout.log
      stderr_logfile=/var/log/qcluster-stderr.log
      startsecs=5
      stopwaitsecs=10

commands:
  01_enable_supervisord:
    command: "systemctl enable supervisord"

container_commands:
  01_start_supervisord:
    command: |
      systemctl start supervisord || true
      supervisorctl reread || true
      supervisorctl update || true